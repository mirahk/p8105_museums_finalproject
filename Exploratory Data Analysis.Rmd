---
title: "Exploratory Data Analysis"
---

```{r, include=FALSE}
library(tidyverse)
library(plotly)
```

```{r, include=FALSE}
#data import and cleaning

museum_df = 
  read_csv("./Data/museums.csv", na = c("NA")) %>% 
  janitor::clean_names() %>% 
  select(
    -legal_name, -alternate_name, -institution_name, -phone_number, -employer_id_number,
    -ends_with("administrative_location"), -starts_with("street_address")) |> 
  drop_na(zip_code_physical_location) |> 
  mutate(
    city = city_physical_location,
    state = state_physical_location,
    zip_code = zip_code_physical_location
  ) |> 
  select(-ends_with("physical_location"))

education_df = 
  read_csv(
    "./Data/ACSST5Y2014.S1501-Data.csv", skip = 1, na = c("-", "**", "***", "(x)")) %>% 
  janitor::clean_names() |> 
  mutate(
    zip_code = as.numeric(str_replace(geographic_area_name, "ZCTA5 ", "")),
    less_than_HS = total_estimate_less_than_high_school_graduate,
    HS_diploma = total_estimate_high_school_graduate_includes_equivalency,
    some_college = total_estimate_some_college_or_associates_degree,
    bachelors = total_estimate_bachelors_degree_or_higher,
    median_income = total_estimate_median_earnings_in_the_past_12_months_in_2014_inflation_adjusted_dollars_population_25_years_and_over_with_earnings
  ) |> 
  select(zip_code, less_than_HS, HS_diploma, some_college, bachelors, median_income)

museum_edu_df =
  inner_join(museum_df, education_df)
```

### Museums Summary (NEEDS FORMATTING PEASE HELP -m)

```{r, echo = FALSE}
museum_edu_df |> 
  group_by(museum_type) |> 
  summarize(
    n = n(),
    mean_income = mean(income, na.rm = TRUE)) |> 
  mutate(
    museum_type = fct_reorder(as_factor(museum_type), mean_income),
    text_label = str_c("Mean Income: $", mean_income)) |> 
  plot_ly(x = ~museum_type, y = ~n, color = ~museum_type, 
          type = "bar", colors = "viridis", text = ~text_label)
```

This bar chart displays the number of each type of museum in the United States. Museum types are sorted by their mean income, so art museums average the most income, followed by natural history museums, of which there are the least museums (n = 62). Historic preservations are represented the most (n = 3877), but have the least average income.

### U.S. States by Number of Museums/Zoos/Aquariums

```{r, echo = FALSE}
museum_edu_df |> 
  count(state) |> 
  mutate(state = fct_reorder(as_factor(state), n)) |> 
  plot_ly(x = ~state, y = ~n, color = ~state, type = "bar", colors = "viridis")
```

New York state has far and away the most museums, zoos, and aquariums (n = 609). DC also has a lot when you consider the fact that it is essentially just a city (n = 42), but this makes sense when you think about DC as the capitol city of the whole country.

### Number of Museums in a City by Average Median Income of the Population

```{r, echo = FALSE, warning = FALSE}
museum_edu_df |> 
  group_by(city) |> 
  summarize(
    n_museums = n(),
    avg_median_income = mean(median_income)
  ) |> 
  filter(n_museums >= 5) |> 
  plot_ly(x = ~n_museums, y = ~avg_median_income, type = "scatter", mode = "markers",
          text = ~city)
```

The above scatterplot shows the number of museums in a city by the average median income of the population over 25 years. Only cities that have at least five museums are included. There does not appear to be much of a correlation, between the two variables; we can see this with the large amount of variation in income for the cities with 5 museums. Notably, New York City has 68 museums, and an average median annual income of $68.7K. Average median income is obtained by average the median income by zip codes within the city.

### Top 10 Museum Cities and Educational Attainment Distributions

```{r, echo = FALSE}
museum_edu_df |>
  group_by(city) |> 
  summarize(
    n_museums = n(),
    est_less_than_HS = mean(less_than_HS, na.rm = TRUE),
    est_HS_diploma = mean(HS_diploma, na.rm = TRUE),
    est_some_college = mean(some_college, na.rm = TRUE),
    est_bachelors = mean(bachelors, na.rm = TRUE)
  ) |> 
  filter(min_rank(desc(n_museums)) < 11) |> 
  knitr::kable(digits = 2)
```

The above table shows the top 10 cities in the U.S. with the most museums, aquariums, or zoos, along with educational attainment estimates. Educational attainment categories are: less than high school, high school diploma or equivalent, some college or associates, and bachelors degree and above. The values are the estimated percentage of the population within each category, calculated by taking the mean estimated percentage across zip codes within the city.

